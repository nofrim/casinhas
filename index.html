<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Engenharia - Campo v4.0</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --blue: #007AFF; --green: #34C759; --yellow: #FFCC00; --red: #FF3B30; --bg: #F2F2F7; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 10px; background: var(--bg); color: #000; padding-bottom: 100px; }
        
        /* Dashboard Fixa no iPhone */
        .dashboard { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); padding: 15px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 15px; position: sticky; top: 10px; z-index: 1000; border: 1px solid #ddd; }
        .stats { display: flex; justify-content: space-around; margin-bottom: 12px; }
        .stat-item { text-align: center; }
        .stat-val { display: block; font-size: 1.4rem; font-weight: 800; }
        .stat-label { font-size: 0.7rem; text-transform: uppercase; color: #666; font-weight: bold; }
        
        .search-box { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #ccc; font-size: 16px; margin-bottom: 10px; -webkit-appearance: none; }

        /* Cards Estilo iOS */
        .section-title { font-weight: 700; color: #8E8E93; margin: 20px 0 8px 5px; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 0.5px; }
        .card { background: white; margin-bottom: 12px; border-radius: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); padding: 15px; border-left: 6px solid var(--yellow); }
        .card.concluido { border-left-color: var(--green); background: #f9fff9; }
        
        .card-header { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .num-id { background: #eee; padding: 2px 8px; border-radius: 6px; font-weight: bold; font-size: 0.8rem; }
        
        .btn-maps { color: var(--blue); text-decoration: none; font-weight: 600; display: block; margin-bottom: 10px; font-size: 1.1rem; }
        .loc-text { font-size: 0.85rem; color: #666; display: block; margin-top: 2px; }

        /* Inputs de Dados */
        .input-group { margin-top: 12px; }
        label { font-size: 0.75rem; font-weight: bold; color: #333; margin-left: 2px; }
        textarea, .link-input { width: 100%; border-radius: 8px; border: 1px solid #D1D1D6; padding: 10px; font-size: 14px; box-sizing: border-box; margin-top: 4px; font-family: inherit; }
        
        .actions { display: flex; gap: 8px; margin-top: 15px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 10px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: 0.2s; }
        .btn-status { background: #E5E5EA; color: #000; }
        .btn-status.done { background: var(--green); color: white; }
        .btn-pdf { background: #000; color: white; width: 100%; margin-top: 10px; font-size: 1rem; padding: 16px; }
    </style>
</head>
<body>

<div class="dashboard">
    <div class="stats">
        <div class="stat-item" style="color: var(--green);"><span id="count-done" class="stat-val">0</span><span class="stat-label">Visitadas</span></div>
        <div class="stat-item" style="color: var(--red);"><span id="count-todo" class="stat-val">0</span><span class="stat-label">Faltam</span></div>
    </div>
    <input type="text" id="busca" class="search-box" placeholder="üîç Buscar Nome, C√≥rrego ou N√∫mero..." oninput="render()">
    <button onclick="gerarPDF()" class="btn-pdf">üìÑ Gerar Relat√≥rio PDF</button>
</div>

<div id="lista-conteudo"></div>

<script>
// BANCO DE DADOS ORGANIZADO PELO SEU ROTEIRO
const roteiroBase = [
    // VARGEM GRANDE
    {id: 12, nome: "EDSON INOCENCIO FERREIRA", endereco: "C√≥rrego Vargem Grande", coords: "-20.471300, -42.018783"},
    {id: 13, nome: "EDUARDO EMERICK SOARES", endereco: "C√≥rrego Vargem Grande", coords: "-20.470644, -42.012942"},
    {id: 05, nome: "BRENO FERREIRA DA SILVA", endereco: "C√≥rrego Vargem Grande", coords: "-20.405522, -41.895681"},
    {id: 14, nome: "ELCEDIR COSTA FOCA DE OLIVEIRA", endereco: "C√≥rrego Vargem Grande", coords: "-20.471108, -42.001172"},
    {id: 16, nome: "EMELY CAROLAYNE CORREA DE SOUZA", endereco: "C√≥rrego Vargem Grande", coords: "-20.470664, -42.001447"},
    {id: 17, nome: "FERNANDO DE ASSUN√á√ÉO QUEIROZ", endereco: "C√≥rrego Vargem Grande", coords: "-20.482092, -42.020036"},
    {id: 18, nome: "FRANCIELE PEREIRA FARIA VIEIRA", endereco: "C√≥rrego Vargem Grande", coords: "-20.488208, -42.022181"},
    {id: 20, nome: "GILSON GARCIAS DA ROZA JUNIOR", endereco: "C√≥rrego Vargem Grande", coords: "-20.468914, -42.012203"},
    {id: 22, nome: "HUGO FERNANDES MIRANDA", endereco: "C√≥rrego Vargem Grande", coords: "-20.466894, -42.015106"},
    {id: 25, nome: "LARISSA FARIA BARROSO", endereco: "C√≥rrego Vargem Grande", coords: "-20.485300, -42.029275"},
    {id: 31, nome: "MARIANE VIANA DA ROZA", endereco: "C√≥rrego Vargem Grande", coords: "-20.472269, -42.000000"},
    {id: 35, nome: "REAN BRAZ DE OLIVEIRA LIMA", endereco: "C√≥rrego Vargem Grande", coords: "-20.477606, -42.000000"},
    {id: 36, nome: "REGINALDO SILVESTRE DOS SANTOS", endereco: "C√≥rrego Vargem Grande", coords: "-20.487664, -42.024856"},
    {id: 39, nome: "SEBASTIAO BARROSO", endereco: "C√≥rrego Vargem Grande", coords: "-20.472525, -42.000000"},
    {id: 40, nome: "SEBASTI√ÉO DOS SANTOS RAMOS", endereco: "C√≥rrego Vargem Grande", coords: "-20.471011, -42.002211"},
    {id: 42, nome: "TATIANE MARQUES SANTOS", endereco: "C√≥rrego Vargem Grande", coords: "-20.489842, -42.034264"},
    {id: 43, nome: "VANESSA CARLA CESAR DA ROZA", endereco: "C√≥rrego Vargem Grande", coords: "-20.480689, -42.000000"},
    {id: 44, nome: "VERONICA DA SILVA DIONIZIO", endereco: "C√≥rrego Vargem Grande", coords: "-20.483039, -41.972231"},
    {id: 46, nome: "WALLACE BORGES DA ROZA", endereco: "C√≥rrego Vargem Grande", coords: "-20.470725, -42.000000"},
    
    // CAPIM ROXO
    {id: 01, nome: "ALEX ESTANECK COELHO", endereco: "C√≥rrego Capim Roxo", coords: "-20.484689, -41.986653"},
    
    // BOA ESPERAN√áA
    {id: 21, nome: "GISELE CORREA VAZ", endereco: "C√≥rrego Boa Esperan√ßa", coords: "-20.481000, -41.915161"},
    
    // BOA SORTE
    {id: 10, nome: "DERCIO JOSE DE SOUZA", endereco: "C√≥rrego Boa Sorte", coords: "-20.437164, -41.944783"},
    
    // INDALASSU
    {id: 24, nome: "JAQUELINE DE OLIVEIRA B. GARCIA", endereco: "C√≥rrego Indalassu", coords: "-20.472611, -42.013028"},
    {id: 47, nome: "WARLEY BORGES DA ROZA", endereco: "C√≥rrego Indalassu", coords: "-20.470656, -42.011811"},
    
    // VISTA ALEGRE
    {id: 07, nome: "CAROLINA DAS GRA√áAS DE O. VIEIRA", endereco: "C√≥rrego Vista Alegre", coords: "-20.437328, -41.947931"},
    
    // VISTA BELA
    {id: 26, nome: "LETICIA DE SOUZA MARTINS AZEVEDO", endereco: "C√≥rrego Vista Bela", coords: "-20.482417, -41.961775"},
    
    // SANTO AUGUSTINHO
    {id: 09, nome: "DENIVAL WERNER", endereco: "C√≥rrego Santo Augustinho", coords: "-20.436397, -41.929142"},
    
    // TAVARES
    {id: 03, nome: "ANA MARIA DE FREITAS", endereco: "C√≥rrego Tavares", coords: "-20.430344, -41.923678"},
    
    // JOS√â PEDRO
    {id: 04, nome: "ANGELICA DA SILVA MARTINS", endereco: "C√≥rrego Jos√© Pedro", coords: "-20.382497, -41.860444"},
    {id: 08, nome: "DANIELA MARCOLINO DE O. FARIA", endereco: "C√≥rrego Jos√© Pedro", coords: "-20.390806, -41.864278"},
    {id: 11, nome: "DIRCINEIA FERREIRA DE A. CAMARA", endereco: "C√≥rrego Jos√© Pedro", coords: "-20.388386, -41.870819"},
    {id: 32, nome: "MARLI OSORIO DOS SANTOS", endereco: "C√≥rrego Jos√© Pedro", coords: "-20.480475, -41.986189"},
    {id: 34, nome: "RAQUEL COSTA OLIVEIRA SILVA", endereco: "C√≥rrego Jos√© Pedro", coords: "-20.377531, -41.862439"},
    {id: 37, nome: "RICARDO CUSTODIO DA SILVA", endereco: "C√≥rrego Jos√© Pedro", coords: "-20.382275, -41.862344"},
    {id: 44, nome: "VERONICA DA SILVA DIONIZIO", endereco: "C√≥rrego Jos√© Pedro", coords: "-20.483039, -41.972231"},
    
    // JACUTINGA
    {id: 02, nome: "ALINE FERNANDES ESTANECK", endereco: "C√≥rrego Jacutinga", coords: "-20.408042, -41.987086"},
    {id: 15, nome: "ELENICE CORREA SILVEIRA", endereco: "C√≥rrego Jacutinga", coords: "-20.410753, -41.915331"},
    {id: 19, nome: "GABRIELA ALVES DE A. FONSECA", endereco: "C√≥rrego Jacutinga", coords: "-20.382789, -41.909478"},
    {id: 23, nome: "IGOR PORTUGAL CORREA", endereco: "C√≥rrego Jacutinga", coords: "-20.402344, -41.964047"},
    {id: 27, nome: "LUANA MAGESTE SINDRA CAETANO", endereco: "C√≥rrego Jacutinga", coords: "-20.471722, -41.900494"},
    {id: 29, nome: "LUCY STANECK CORREA", endereco: "C√≥rrego Jacutinga", coords: "-20.459236, -41.978158"},
    {id: 33, nome: "PAMELA BOREL DOS SANTOS SILVA", endereco: "C√≥rrego Jacutinga", coords: "-20.406397, -41.898014"},
    {id: 38, nome: "SABRINA SALIM ROQUE", endereco: "C√≥rrego Jacutinga", coords: "-20.403358, -41.897942"},
    {id: 41, nome: "SILVINA DE FATIMA PACHECO", endereco: "C√≥rrego Jacutinga", coords: "-20.387678, -41.912203"},
    {id: 45, nome: "VILMA APARECIDA DOS SANTOS", endereco: "C√≥rrego Jacutinga", coords: "-20.487336, -42.022050"},
    
    // PO√áO DANTA
    {id: 06, nome: "BRUNO FERREIRA ANDRADE", endereco: "C√≥rrego Po√ßo Danta", coords: "-20.469133, -42.001147"},
    {id: 30, nome: "MARCOS ANTONIO CESAR", endereco: "C√≥rrego Po√ßo Danta", coords: "-20.469950, -42.003231"}
];

function initDB() {
    const salvos = localStorage.getItem('casinhas_v4');
    if (!salvos) {
        const bdInicial = roteiroBase.map(item => ({...item, status: 'pendente', obs: '', fotos: ''}));
        localStorage.setItem('casinhas_v4', JSON.stringify(bdInicial));
        return bdInicial;
    }
    return JSON.parse(salvos);
}

function salvarItem(id, campo, valor) {
    let dados = JSON.parse(localStorage.getItem('casinhas_v4'));
    let idx = dados.findIndex(u => u.id === id);
    dados[idx][campo] = valor;
    localStorage.setItem('casinhas_v4', JSON.stringify(dados));
    if(campo === 'status') render();
}

function render() {
    const lista = document.getElementById('lista-conteudo');
    const busca = document.getElementById('busca').value.toLowerCase();
    const dados = JSON.parse(localStorage.getItem('casinhas_v4'));
    
    let html = '';
    let lastSetor = '';
    let done = 0;

    dados.forEach(u => {
        if(u.status === 'concluido') done++;
        if(!u.nome.toLowerCase().includes(busca) && !u.endereco.toLowerCase().includes(busca) && !u.id.toString().includes(busca)) return;

        if(u.endereco !== lastSetor) {
            html += `<div class="section-title">üìç ${u.endereco}</div>`;
            lastSetor = u.endereco;
        }

        html += `
            <div class="card ${u.status}">
                <div class="card-header">
                    <span class="num-id">#${u.id.toString().padStart(2, '0')}</span>
                </div>
                <a class="btn-maps" href="https://www.google.com/maps/dir/?api=1&destination=${u.coords}" target="_blank">
                    ${u.nome}
                    <span class="loc-text">Ver no Maps: ${u.coords}</span>
                </a>
                
                <div class="input-group">
                    <label>OCORR√äNCIAS DA MEDI√á√ÉO</label>
                    <textarea rows="2" onchange="salvarItem(${u.id}, 'obs', this.value)">${u.obs}</textarea>
                </div>
                
                <div class="input-group">
                    <label>LINK DA PASTA DE FOTOS (CLOUD)</label>
                    <input type="text" class="link-input" placeholder="Cole o link aqui..." 
                        value="${u.fotos}" onchange="salvarItem(${u.id}, 'fotos', this.value)">
                </div>

                <div class="actions">
                    <button class="btn-status ${u.status === 'concluido' ? 'done' : ''}" onclick="toggleStatus(${u.id})">
                        ${u.status === 'concluido' ? '‚úÖ VISITADO' : 'üü° PENDENTE'}
                    </button>
                </div>
            </div>
        `;
    });

    lista.innerHTML = html;
    document.getElementById('count-done').innerText = done;
    document.getElementById('count-todo').innerText = dados.length - done;
}

function toggleStatus(id) {
    let dados = JSON.parse(localStorage.getItem('casinhas_v4'));
    let idx = dados.findIndex(u => u.id === id);
    dados[idx].status = dados[idx].status === 'pendente' ? 'concluido' : 'pendente';
    localStorage.setItem('casinhas_v4', JSON.stringify(dados));
    render();
}

function gerarPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const dados = JSON.parse(localStorage.getItem('casinhas_v4'));
    let y = 20;

    doc.setFontSize(16);
    doc.text("Relat√≥rio Geral de Vistorias - Engenharia", 15, 15);
    doc.setFontSize(10);

    dados.forEach(u => {
        if(y > 270) { doc.addPage(); y = 20; }
        doc.setFont(undefined, 'bold');
        doc.text(`#${u.id} - ${u.nome} [${u.status.toUpperCase()}]`, 15, y);
        y += 5;
        doc.setFont(undefined, 'normal');
        doc.text(`Localidade: ${u.endereco} | GPS: ${u.coords}`, 15, y);
        y += 5;
        doc.text(`Ocorr√™ncias: ${u.obs || 'Nenhuma registrada'}`, 15, y);
        y += 5;
        if(u.fotos) {
            doc.setTextColor(0, 0, 255);
            doc.text(`Fotos: ${u.fotos}`, 15, y);
            doc.setTextColor(0, 0, 0);
        }
        y += 12;
    });

    doc.save("vistorias_engenharia.pdf");
}

window.onload = () => { initDB(); render(); };
</script>
</body>
</html>
